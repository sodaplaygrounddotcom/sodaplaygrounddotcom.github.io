
<!DOCTYPE html>
<html>
<head>
	<meta name="google-site-verification" content="YGLGbeXpCc-P6786oW13QN26qlmZtR4-jC3RBRneyds" />
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript"> if (!window.console) console = {log: function() {}}; </script>
<title>SODA Playground</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="https://cdn.rawgit.com/avianey/jqDoubleScroll/master/jquery.doubleScroll.js"></script>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.6/cerulean/bootstrap.min.css" />
  <style type="text/css">
  body {
  	padding-top:51px;
  }
  .gitter-open-chat-button {
    top:51px;
    height:41px;
  }
  .dropdown-menu>li
{	position:relative;
	-webkit-user-select: none; /* Chrome/Safari */        
	-moz-user-select: none; /* Firefox */
	-ms-user-select: none; /* IE10+ */
	/* Rules below not implemented in browsers yet */
	-o-user-select: none;
	user-select: none;
	cursor:pointer;
}
.dropdown-menu .sub-menu {
    left: 100%;
    position: absolute;
    top: 0;
    display:none;
    margin-top: -1px;
	border-top-left-radius:0;
	border-bottom-left-radius:0;
	border-left-color:#fff;
	box-shadow:none;
}
.right-caret:after,.left-caret:after
 {	content:"";
    border-bottom: 5px solid transparent;
    border-top: 5px solid transparent;
    display: inline-block;
    height: 0;
    vertical-align: middle;
    width: 0;
	margin-left:5px;
}
.right-caret:after
{	border-left: 5px solid #ffaf46;
}
.left-caret:after
{	border-right: 5px solid #ffaf46;
}
  .modal-dialog {
  width: 98%;
  height: 92%;
  padding: 0;
}

.modal-content {
  height: 99%;
}
  .footer {
  	display:block !important;
  width: 100%;
  /* Set the fixed height of the footer here */
  height: 41px  !important;
  line-height:14px;
  text-align:left;
  padding:13px 10px !important;
  background-image: linear-gradient(#04519b, #044687 60%, #033769);
  color:#FFF;
}
.footer a:link, .footer a:visited, .jumbotron h1 a:link, .jumbotron h1 a:visited {
	color:#FFF;
	text-decoration:underline;
}
.footer a:hover, .jumbotron h1 a:hover {
	text-decoration:none;
}
  .scrollable-menu {
    height: auto;
    max-height: 200px;
    overflow-x: hidden;
}
  .dropdown:hover > .dropdown-menu {
display: block;
}
.dropdown-menu > .sub-menu {
  display:block;
}
  #header a:link, #header a:visited {
    color:#FFF;
  }
  table {
  overflow:auto;
  }
  body {
  margin:0;
  }
    ul ul {
  padding-left:20px;
}
#right_sidebar {
  float:right;
  width:300px;
}
.highlight {
  background:yellow;
}
td, th {
  vertical-align:top;
  text-align:left;
}
#dataset_viewer {
	display:none;
}
table {
  border-collapse:collapse;
}
#header {
background:#000;
color:#FFF;
padding:10px;
}
#data {
overflow:auto;

}
#data {
overflow-y:auto !important;	
}
.ui-autocomplete {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  float: left;
  display: none;
  min-width: 160px;
  _width: 160px;
  padding: 4px 0;
  margin: 2px 0 0 0;
  list-style: none;
  background-color: #ffffff;
  border-color: #ccc;
  border-color: rgba(0, 0, 0, 0.2);
  border-style: solid;
  border-width: 1px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
  -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  -moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  -webkit-background-clip: padding-box;
  -moz-background-clip: padding;
  background-clip: padding-box;
  *border-right-width: 2px;
  *border-bottom-width: 2px;

  .ui-menu-item > a.ui-corner-all {
    display: block;
    padding: 3px 15px;
    clear: both;
    font-weight: normal;
    line-height: 18px;
    color: #555555;
    white-space: nowrap;

    &.ui-state-hover, &.ui-state-active {
      color: #ffffff;
      text-decoration: none;
      background-color: #0088cc;
      border-radius: 0px;
      -webkit-border-radius: 0px;
      -moz-border-radius: 0px;
      background-image: none;
    }
  }
}
input[type=text] {
  border:1px solid #000;
}
#header input[type=text] {
  border:1px solid #FFF;
  background:#000;
  color:#FFF;
}
#head {
  background:orange;
}
#map_table {
  width:100%;
  display:table;
}
#states_federal {
  width:200px;
}
#map_table th, #map_table td {
  border:0;
  background:#000;
  color:#FFF;
}
a.filter_url:link, a.filter_url:visited {
  color:#000;
  text-decoration:none;
}
.chat-app {
  z-index:5;
  top:51px;
}
.jumbotron {
	position:absolute;
	background-image:linear-gradient(#54b4eb, #2fa4e7 60%, #1d9ce5);
	opacity: 0.92;
	top:92px;
	left:0;
	width:100%;
	margin:0;
	padding:15px;
	z-index:1;
}
.jumbotron .btn-group {
	margin:-20px 0 0 20px;
}
.jumbotron h1 {
	display:inline;
	font-size:40px;
	margin:0;
	color:#FFF;
}
  </style>

  <title></title>

  
    

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
        
        <script type="text/javascript">
function sortByKey(array, key) {
    return array.sort(function(a, b) {
        var x = a[key]; var y = b[key];
        return ((x < y) ? -1 : ((x > y) ? 1 : 0));
    });
}
function distance(lat1, lon1, lat2, lon2, unit) {
	var radlat1 = Math.PI * lat1/180
	var radlat2 = Math.PI * lat2/180
	var theta = lon1-lon2
	var radtheta = Math.PI * theta/180
	var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
	dist = Math.acos(dist)
	dist = dist * 180/Math.PI
	dist = dist * 60 * 1.1515
	if (unit=="K") { dist = dist * 1.609344 }
	if (unit=="N") { dist = dist * 0.8684 }
	return dist
}
            // When the window has finished loading create our google map below
            google.maps.event.addDomListener(window, 'load', init);
        
            function init() {
                // Basic options for a simple Google Map
                // For more options see: https://developers.google.com/maps/documentation/javascript/reference#MapOptions
                var mapOptions = {
                    // How zoomed in you want the map to start at (always required)
                    center: {lat: 41.850033, lng: -87.6500523},
                    // 41.850033, -87.6500523
                    zoom: 4,

                    // How you would like to style the map. 
                    // This is where you would paste any style found on Snazzy Maps.
                    styles: [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#46bcec"},{"visibility":"on"}]}]};

                // Get the HTML DOM element that will contain your map 
                // We are using a div with id="map" seen below in the <body>
                var mapElement = document.getElementById('map');

                // Create the Google Map using our element and options defined above
                var domains_to_icons = {"data.albanyny.gov": "https://data.albanyny.gov/assets/C066F4C2-2C49-4800-AD09-552870E92ABC", "opendata.miamidade.gov": "https://opendata.miamidade.gov/stylesheets/images/common/favicon.ico", "reports.data.montgomerycountymd.gov": "https://reports.data.montgomerycountymd.gov/assets/B8D59DF0-9468-412B-87AC-DF0AFAAC5E98", "ntis.data.commerce.gov": "https://ntis.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.seattle.gov": "https://data.seattle.gov/stylesheets/images/domains/data.seattle.gov/favicon.ico", "cdph.data.ca.gov": "https://cdph.data.ca.gov/assets/63B7950B-76EC-4458-ACEB-9A78BFE0E4FB", "data.urbanaillinois.us": "https://data.urbanaillinois.us/api/assets/3F083DEA-824A-4480-9788-F793CB067AEE", "data.medicaid.gov": "https://data.medicaid.gov/stylesheets/images/common/favicon.ico", "data.baltimorecity.gov": "https://data.baltimorecity.gov/stylesheets/images/domains/baltimore.socrata.com/favicon.ico", "bythenumbers.sco.ca.gov": "https://bythenumbers.sco.ca.gov/api/assets/18394799-4AF7-4119-940A-2B29A3A82D22", "healthdata.nj.gov": "https://healthdata.nj.gov/stylesheets/images/common/favicon.ico", "data.dcpcsb.org": "https://data.dcpcsb.org/assets/910DA7A0-BFC3-4CFA-9154-EB67F49B5445", "data.cityofwestsacramento.org": "https://data.cityofwestsacramento.org/stylesheets/images/common/favicon.ico", "chronicdata.cdc.gov": "https://chronicdata.cdc.gov/api/assets/548D1B38-F11F-464F-A05B-EC0751C49D15", "stat.cityofgainesville.org": "https://stat.cityofgainesville.org/stylesheets/images/common/favicon.ico", "www.opendata.go.ke": "https://www.opendata.go.ke/stylesheets/images/domains/kenya.socrata.com/favicon.ico", "impact.stlouisco.com": "https://impact.stlouisco.com/api/assets/18E5A45A-8FA6-494F-9996-6064426B40CE", "pqrs.cms.gov": "https://pqrs.cms.gov/api/assets/9B2496D0-BD84-43AB-B99D-33585A3672B2", "data.vermont.gov": "https://data.vermont.gov/stylesheets/images/common/favicon.ico", "data.iae.alberta.ca": "https://data.iae.alberta.ca/api/assets/A4A74D20-6419-41D1-9F9C-0D03CF4F38EB", "permits.partner.socrata.com": "https://permits.partner.socrata.com/stylesheets/images/common/favicon.ico", "performance.cityofrc.us": "https://performance.cityofrc.us/api/assets/845D81B2-92DF-4F9A-AE82-92722E3116F1", "sdotperformance.seattle.gov": "https://seattle-govstat.demo.socrata.com/api/assets/6955FDDD-2CAD-4E27-8C91-5995210B164D", "data.danvilleva.gov": "https://data.danvilleva.gov/api/assets/CCCB40EE-C156-45E6-9CAD-D0BC05347DD1", "datacatalog.cookcountyil.gov": "http://www.cookcountygov.com/favicon.ico", "data.smgov.net": "https://data.smgov.net/api/assets/3670F1D5-58FF-440B-B1D0-6332183022ED?favicon.ico", "data.nashville.gov": "https://data.nashville.gov/stylesheets/images/common/favicon.ico", "www.indicadores.pr": "https://www.indicadores.pr/stylesheets/images/common/favicon.ico", "nist.data.commerce.gov": "https://nist.data.commerce.gov/stylesheets/images/common/favicon.ico", "hsmp-data.aspe.hhs.gov": "https://hsmp-data.aspe.hhs.gov/stylesheets/images/domains/hstp/favicon.ico", "data.fortworthtexas.gov": "https://data.fortworthtexas.gov/stylesheets/images/common/favicon.ico", "performance.louisvilleky.gov": "https://performance.louisvilleky.gov/api/assets/1668217D-18CE-42FC-9FA6-C7A1D80BE0C9", "performance.lacity.org": "https://performance.lacity.org/stylesheets/images/common/favicon.ico", "data.cms.gov": "https://www.cms.gov/favicon.ico", "data.smcgov.org": "https://data.smcgov.org/assets/A102BE76-7ACA-4160-9FAF-8F17BF69266C", "data.illinois.gov": "https://data.illinois.gov/stylesheets/images/common/favicon.ico", "data.michigan.gov": "https://data.michigan.gov/api/assets/DAE83460-835F-4EFE-8CCB-1E97A2C49E3F", "data.brla.gov": "https://data.brla.gov/api/assets/66AD997B-F7F8-4196-BF02-C6F071CFFCFE", "data.littlerock.org": "https://data.littlerock.org/stylesheets/images/common/favicon.ico", "data.ftb.ca.gov": "https://data.ftb.ca.gov/assets/897A253F-AD41-4EC2-822E-579A34DD9B99", "performance.kingcounty.gov": "https://performance.kingcounty.gov/assets/EA090635-B1FC-4FE8-BD31-5D14EC281342", "data.cambridgema.gov": "https://data.cambridgema.gov/assets/C9593071-19B3-4E38-AA45-850A205A2809", "data.wellingtonfl.gov": "https://data.wellingtonfl.gov/stylesheets/images/common/favicon.ico", "brigades.opendatanetwork.com": "https://brigades.opendatanetwork.com/stylesheets/images/common/favicon.ico", "finances.worldbank.org": "https://finances.worldbank.org/stylesheets/images/domains/ctrpilot.socrata.com/favicon.ico", "data.opendatanetwork.com": "https://data.opendatanetwork.com/stylesheets/images/common/favicon.ico", "data.montgomerycountymd.gov": "https://data.montgomerycountymd.gov/assets/B8D59DF0-9468-412B-87AC-DF0AFAAC5E98", "data.burlingtonvt.gov": "https://data.burlingtonvt.gov/stylesheets/images/common/favicon.ico", "www.data.act.gov.au": "https://www.data.act.gov.au/assets/8C9B3757-4F47-4173-88AF-7CB6A73C7207", "data.redmond.gov": "https://data.redmond.gov/stylesheets/images/common/favicon.ico", "results.ri.gov": "https://results.ri.gov/api/assets/3C5691E5-9B23-4DCA-9B94-6C550CA7F9A1", "bis.data.commerce.gov": "https://bis.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.cityofgp.com": "https://data.cityofgp.com/stylesheets/images/common/favicon.ico", "data.macoupincountyil.gov": "https://data.macoupincountyil.gov/api/assets/FA86D62B-A6A5-45AD-AF7A-55DE470FF910", "data.code4sa.org": "https://data.code4sa.org/stylesheets/images/common/favicon.ico", "data.weho.org": "https://data.weho.org/stylesheets/images/common/favicon.ico", "lives.data.socrata.com": "https://lives.data.socrata.com/stylesheets/images/common/favicon.ico", "data.murphytx.org": "https://data.murphytx.org/stylesheets/images/common/favicon.ico", "data.ny.gov": "https://data.ny.gov/assets/CC0177A8-993C-4383-AA8E-FDC41F2AF46F", "data.lacity.org": "https://data.lacity.org/api/assets/92E97CD2-9DC6-4889-8372-FE3960A8D733", "noaa.data.commerce.gov": "https://noaa.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.maryland.gov": "https://data.maryland.gov/assets/AED51A33-C2DC-45E3-9809-2633DEA767DD", "dashboard.slco.org": "https://dashboard.slco.org/api/assets/0F606FCC-D2DA-470F-A2F5-6AC9C40A6B51", "data.oaklandnet.com": "https://data.oaklandnet.com/stylesheets/images/common/favicon.ico", "performance.reno.gov": "https://performance.reno.gov/stylesheets/images/common/favicon.ico", "data.cityoftacoma.org": "https://data.cityoftacoma.org/stylesheets/images/common/favicon.ico", "data.tol.ca": "https://data.tol.ca/stylesheets/images/common/favicon.ico", "bea.data.commerce.gov": "https://bea.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.medicare.gov": "http://www.medicare.gov/favicon.ico", "data.nj.gov": "https://data.nj.gov/stylesheets/images/common/favicon.ico", "data.southbendin.gov": "https://data.southbendin.gov/stylesheets/images/common/favicon.ico", "data.hawaii.gov": "https://data.hawaii.gov/assets/563B6521-2C99-40C1-9841-01291066A9EA", "data.menlopark.org": "https://data.menlopark.org/stylesheets/images/common/favicon.ico", "electionsdata.kingcounty.gov": "https://electionsdata.kingcounty.gov/stylesheets/images/common/favicon.ico", "data.kingcounty.gov": "https://www.kingcounty.gov/favicon.ico", "dashboard.hawaii.gov": "https://dashboard.hawaii.gov/assets/563B6521-2C99-40C1-9841-01291066A9EA", "data.colorado.gov": "https://data.colorado.gov/api/assets/40C632C1-0F18-4292-BFA4-03D373F1154F", "data.sustainablesm.org": "https://data.sustainablesm.org/api/assets/DC4422EE-82E2-426E-B752-4DEAE79AD26D", "reportcard.santamonicayouth.net": "https://reportcard.santamonicayouth.net/stylesheets/images/common/favicon.ico", "data.acgov.org": "https://data.acgov.org/stylesheets/images/common/favicon.ico", "data.austintexas.gov": "https://data.austintexas.gov/assets/A857D660-03E2-400B-94A9-B0C9BE3AB6C0", "results.livewellsd.org": "https://results.livewellsd.org/stylesheets/images/common/favicon.ico", "data.exim.gov": "https://data.exim.gov/stylesheets/images/common/favicon.ico", "data.oregon.gov": "https://data.oregon.gov/stylesheets/images/domains/data.oregon.gov/oregon_data.ico", "www.aercdevdata.org": "https://www.aercdevdata.org/assets/727B8469-4EDC-4181-A5DE-426CA9C82E96", "outcomestat.baltimorecity.gov": "https://outcomestat.baltimorecity.gov/assets/40BBA54F-953E-45DF-B2E5-BB7BAFB9907B", "policeview.johnscreekga.gov": "https://policeview.johnscreekga.gov/assets/EB264E44-61BF-4420-A7BD-9B820D8D2FD3", "data.atf.gov": "https://data.atf.gov/api/assets/60EE78B6-E66E-434E-AA2E-19D4BF6952F5", "data.edmonton.ca": "https://data.edmonton.ca/api/assets/C98F5E48-01A7-4AF8-936B-89051FD758E3", "data.sonomacounty.ca.gov": "https://data.sonomacounty.ca.gov", "opendata.howardcountymd.gov": "https://opendata.howardcountymd.gov/api/assets/98DE9A69-3936-4AD3-94AC-BDC4C905728F", "data.waterpointdata.org": "https://data.waterpointdata.org/api/assets/B6BDA6E1-E825-492D-9685-4AD203020C68", "impact.glispa.org": "https://impact.glispa.org/api/assets/0E20921C-12ED-46B4-A8EE-CAF6CE80C1F2", "eda.data.commerce.gov": "https://eda.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.richmondgov.com": "https://data.richmondgov.com/api/assets/3453F457-4089-422C-A265-E03F53314E3B", "data.detroitmi.gov": "https://data.detroitmi.gov/api/assets/1473A904-0620-4DAA-9780-01B0CD35AC62", "www.opendatanyc.com": "https://www.opendatanyc.com/assets/F8933467-F29D-4895-B794-1188ADEE24D7", "data.maine.gov": "https://data.maine.gov/api/assets/A8A70D6C-EDBD-4EF7-9009-EFDCDEC33F99", "opendata.utah.gov": "https://opendata.utah.gov/stylesheets/images/common/favicon.ico", "data.debtwatch.treasurer.ca.gov": "https://data.debtwatch.treasurer.ca.gov/api/assets/0CBF67CE-FE0C-446E-913B-66DAD2826730", "data.imls.gov": "https://data.imls.gov/api/assets/BB9CA17F-8EE0-42E1-BA5F-869A93514807", "data.iowa.gov": "https://data.iowa.gov/api/assets/796D9CCE-FC18-4048-83F2-E4180558557E", "data.ct.gov": "https://data.ct.gov/api/assets/30E9A0BC-CCA7-4E12-AD70-65E1053DC185", "data.mo.gov": "https://data.mo.gov/stylesheets/images/common/favicon.ico", "opendata.lasvegasnevada.gov": "https://opendata.lasvegasnevada.gov/api/assets/96DA65DB-A97D-470C-B6AB-0E50FF85CB0D", "data.oxnard.org": "https://data.oxnard.org/stylesheets/images/common/favicon.ico", "data.healthcare.gov": "http://www.cms.gov/favicon.ico", "data.texas.gov": "https://data.texas.gov/api/assets/94D3EC96-D079-4336-B5C6-D33C6CDC05E3", "ita.data.commerce.gov": "https://ita.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.cityofgainesville.org": "https://data.cityofgainesville.org/stylesheets/images/common/favicon.ico", "data.nfpa.org": "https://data.nfpa.org/stylesheets/images/common/favicon.ico", "data.honolulu.gov": "https://data.honolulu.gov/stylesheets/images/common/favicon.ico", "performance.alexandriava.gov": "https://performance.alexandriava.gov/api/assets/A49E20C3-F60C-4A5F-89C9-D5C2A2A296B2", "data.phila.gov": "https://data.phila.gov/stylesheets/images/common/favicon.ico", "data.cityofboston.gov": "https://data.cityofboston.gov/stylesheets/images/common/favicon.ico", "performance.seattle.gov": "https://performance.seattle.gov/api/assets/00D829EC-F562-4C2D-9332-589DF972B038", "results.nola.gov": "https://results.nola.gov/api/assets/7D316FF1-D314-4616-B79C-F84F6286311A?favicon.ico", "www.criminalytics.org": "https://www.criminalytics.org/stylesheets/images/common/favicon.ico", "data.topeka.org": "https://data.topeka.org/assets/61672784-C36F-42A6-877F-4B01EA1896DF", "census.data.commerce.gov": "https://census.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.readingpa.gov": "https://data.readingpa.gov/assets/ECFB31F2-8CA4-4334-9096-2F0844E68654", "performance.austintexas.gov": "https://performance.austintexas.gov/stylesheets/images/common/favicon.ico", "data.lacounty.gov": "https://data.lacounty.gov/api/assets/8B9974C8-0809-4AE4-8F2A-FF0389B7052E", "data.results.wa.gov": "https://data.wa.gov/favicon.ico", "performance.chattanooga.gov": "https://performance.chattanooga.gov/api/assets/B2B5B5A3-CA75-43AA-9064-4597BA2DC943?chattanoogacityseal.ico", "data.rentonwa.gov": "https://data.rentonwa.gov/stylesheets/images/common/favicon.ico", "data.nlc.org": "https://data.nlc.org/stylesheets/images/common/favicon.ico", "chhs.data.ca.gov": "https://chhs.data.ca.gov/api/assets/6F59E516-3853-49B9-B39D-51D170E1E6D1", "data.vta.org": "https://data.vta.org/stylesheets/images/common/favicon.ico", "data.raleighnc.gov": "https://data.raleighnc.gov/assets/33EFE573-0C94-44C8-B7F7-BA4079316045", "data.roseville.ca.us": "https://data.roseville.ca.us/stylesheets/images/common/favicon.ico", "data.energystar.gov": "http://www.energystar.gov/favicon.ico", "data.pr.gov": "https://data.pr.gov/api/assets/8C801AC4-8AEC-485B-8FC3-2E0CF5564B36", "www.dallasopendata.com": "https://www.dallasopendata.com/stylesheets/images/common/favicon.ico", "data.douglas.co.us": "https://data.douglas.co.us/assets/7DDB6481-CF46-4C83-9633-BEE85F3C268C", "landslide.data.nasa.gov": "https://landslide.data.nasa.gov/stylesheets/images/common/favicon.ico", "ntia.data.commerce.gov": "https://ntia.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.strathcona.ca": "https://data.strathcona.ca/stylesheets/images/common/favicon.ico", "www.forsythfutures.org": "https://www.forsythfutures.org/assets/A2FE2E8D-73FF-4026-81A7-2ADDBA342F44", "data.cese.nsw.gov.au": "https://data.cese.nsw.gov.au/stylesheets/images/common/favicon.ico", "data.wa.gov": "http://access.wa.gov/favicon.ico", "mayorbudget.miamidade.gov": "https://mayorbudget.miamidade.gov/stylesheets/images/common/favicon.ico", "data.cityofchicago.org": "http://www.cityofchicago.org/etc/designs/city/favicon.ico", "opendata.american.edu": "https://opendata.american.edu/api/assets/527EECD1-6FCE-44E9-A036-FD87CB636B46?favicon.ico", "data.providenceri.gov": "https://data.providenceri.gov/stylesheets/images/common/favicon.ico", "data.monroecounty-fl.gov": "https://data.monroecounty-fl.gov/api/assets/17D2BF8C-6A23-4E63-B196-00A2F74B3649", "data.melbourne.vic.gov.au": "https://data.melbourne.vic.gov.au/stylesheets/images/common/favicon.ico", "health.data.ny.gov": "https://health.data.ny.gov/assets/CC0177A8-993C-4383-AA8E-FDC41F2AF46F", "data.indy.gov": "https://data.indy.gov/stylesheets/images/common/favicon.ico", "data.commerce.gov": "https://data.commerce.gov/api/assets/982DD8D9-1C86-40DD-8FED-3675FCB0288A", "data.consumerfinance.gov": "https://data.consumerfinance.gov/stylesheets/images/common/favicon.ico", "controllerdata.lacity.org": "https://controllerdata.lacity.org/api/assets/82CD444F-E070-4A6E-AFE4-F26A49528836", "transparency.vi.gov": "https://transparency.vi.gov/api/assets/F94BD689-3EBC-4B9D-849D-DE3C217DD467", "mydata.iadb.org": "https://mydata.iadb.org/assets/25811DC6-98AB-4866-AF54-F85B1A89D7D7", "dashboard.edmonton.ca": "https://dashboard.edmonton.ca/api/assets/C98F5E48-01A7-4AF8-936B-89051FD758E3", "data.livewellsd.org": "https://data.livewellsd.org/stylesheets/images/common/favicon.ico", "opendata.cityofhenderson.com": "https://opendata.cityofhenderson.com/stylesheets/images/common/favicon.ico", "openpaymentsdata.cms.gov": "https://www.cms.gov/favicon.ico", "dashboard.plano.gov": "https://dashboard.plano.gov/stylesheets/images/common/favicon.ico", "data.datamontana.us": "https://data.datamontana.us/stylesheets/images/common/favicon.ico", "data.nola.gov": "https://data.nola.gov/assets/6C6B548A-0FB6-47AA-85CA-0C736427AE30", "data.cityofberkeley.info": "https://data.cityofberkeley.info/stylesheets/images/common/favicon.ico", "data.somervillema.gov": "https://data.somervillema.gov/stylesheets/images/common/favicon.ico", "databox.worldbank.org": "https://databox.worldbank.org/api/assets/A1724688-B67C-4328-B1CF-3AE1966515CB", "bchi.bigcitieshealth.org": "https://bchi.bigcitieshealth.org/api/assets/3E7CB5B2-2D15-406C-9EDE-E49183100CEA", "data.orcities.org": "https://data.orcities.org/api/assets/8A1C03EA-95D5-4B73-B58D-0A1B8FB69485", "data.mass.gov": "https://data.mass.gov/api/assets/94BC1934-9561-4A1B-8306-E120C5EF3A59?MassSeal.ico", "performance.smcgov.org": "https://performance.smcgov.org/stylesheets/images/common/favicon.ico", "data.sunshinecoast.qld.gov.au": "https://data.sunshinecoast.qld.gov.au/api/assets/BA9B38A2-4754-4D8D-8F35-BB9C9A116512", "data.montgomeryschoolsmd.org": "https://data.montgomeryschoolsmd.org/api/assets/A30778C0-AA79-4811-973F-4FE2A774A0DF?mcps.ico", "data.norfolk.gov": "https://data.norfolk.gov/stylesheets/images/common/favicon.ico", "opencheckbook.data.somervillema.gov": "https://opencheckbook.data.somervillema.gov/stylesheets/images/common/favicon.ico", "bronx.lehman.cuny.edu": "https://bronx.lehman.cuny.edu/stylesheets/images/common/favicon.ico", "data.culvercity.org": "https://data.culvercity.org/stylesheets/images/common/favicon.ico", "performance.action.act.gov.au": "https://performance.action.act.gov.au/assets/BF84F44F-39BA-4B3D-9720-3CBBC2AEAE04", "data.cic.mx": "https://data.cic.mx/stylesheets/images/common/favicon.ico", "data.policefoundation.org": "https://data.policefoundation.org/assets/B1FF3B7B-D56E-47A0-AF56-836C8E8EE583", "data.srcity.org": "https://data.srcity.org/api/assets/0A4DB582-4E88-4173-8F9C-F42F9233E469", "midashboard.michigan.gov": "https://midashboard.michigan.gov/api/assets/AA6582D6-4628-4E16-B3B8-9DCFDD794966", "transparency.michigan.gov": "https://transparency.michigan.gov/assets/A716DA60-501D-4513-8A17-A6AF630121A4", "data.cityofnewyork.us": "https://data.cityofnewyork.us/stylesheets/images/common/favicon.ico", "kcstat.kcmo.org": "https://kcstat.kcmo.org/stylesheets/images/common/favicon.ico", "www.datossct.gob.mx": "https://www.datossct.gob.mx/api/assets/2CD4302B-FCCC-4E1C-BF63-E86D96981A1C?MX-ODP_SCT_favicon.png", "performance.cookcountyil.gov": "https://performance.cookcountyil.gov/stylesheets/images/common/favicon.ico", "data.govloop.com": "http://www.govloop.com/favicon.ico", "idp.nz": "https://idp.nz/api/assets/ADE2C0A9-711A-4036-BD22-7FE1DD876AC2", "datapoints.dallascityhall.com": "https://datapoints.dallascityhall.com/stylesheets/images/common/favicon.ico", "data.countyofriverside.us": "https://data.countyofriverside.us/stylesheets/images/common/favicon.ico", "data.hampton.gov": "https://data.hampton.gov/stylesheets/images/common/favicon.ico", "data.chattlibrary.org": "https://data.chattlibrary.org/api/assets/07AF73DF-6C66-4611-8504-267128D6B8BC?favicon.ico", "data.sfgov.org": "https://data.sfgov.org/stylesheets/images/common/favicon.ico", "open.whitehouse.gov": "https://open.whitehouse.gov/assets/954D87AA-AB28-4C5F-9837-EB776C50621B", "cip.cityofnovi.org": "https://cip.cityofnovi.org/stylesheets/images/common/favicon.ico", "data.princegeorgescountymd.gov": "https://data.princegeorgescountymd.gov/api/assets/DAE2D0DC-3B21-4C8B-8B40-5D48B4FDFFA1", "data.cityofmadison.com": "https://data.cityofmadison.com/api/assets/B7109CB1-B70D-4FD2-B7C1-166612963241", "greengov.data.ca.gov": "https://greengov.data.ca.gov/api/assets/06355167-4248-4C53-ABDF-7F9DC01AA443", "data.cdc.gov": "https://data.cdc.gov/api/assets/749298ED-2FF4-4B90-A770-A8D2FF9C1477", "data.auburnwa.gov": "https://data.auburnwa.gov/api/assets/59A1757F-E27F-4FDF-83A9-A502ABDC60BD", "data.sunlightlabs.com": "https://data.sunlightlabs.com/stylesheets/images/common/favicon.ico", "uspto.data.commerce.gov": "https://uspto.data.commerce.gov/stylesheets/images/common/favicon.ico", "data.nccde.org": "https://data.nccde.org/stylesheets/images/common/favicon.ico", "data.greensboro-nc.gov": "https://data.greensboro-nc.gov/api/assets/94C04432-D881-4355-8872-9DADB9C6462C", "www.sudandata.org": "https://www.sudandata.org/stylesheets/images/common/favicon.ico", "data.rutlandcitypolice.com": "https://data.rutlandcitypolice.com/stylesheets/images/common/favicon.ico", "data.kcmo.org": "https://data.kcmo.org/stylesheets/images/common/favicon.ico", "2014bonds.cityofws.org": "https://2014bonds.cityofws.org/api/assets/B7007454-4691-450F-B155-E8EEC99DCFE3", "data.nasa.gov": "https://data.nasa.gov/assets/17FE2F90-AA44-46D9-8325-1780AEE015EA", "performance.franklintn.gov": "https://performance.franklintn.gov/assets/E7000C31-19CF-4B96-943B-1E003444A1ED", "performance.glendaleca.gov": "https://performance.glendaleca.gov/stylesheets/images/common/favicon.ico", "data.winnipeg.ca": "https://data.winnipeg.ca/stylesheets/images/common/favicon.ico", "www.pipadados.com": "https://www.pipadados.com/stylesheets/images/common/favicon.ico", "data.cincinnati-oh.gov": "https://data.cincinnati-oh.gov/api/assets/F058B458-11FD-4E7D-A9F5-9CB3046D06E7", "data.hartford.gov": "https://data.hartford.gov/stylesheets/images/common/favicon.ico", "performance.danvilleva.gov": "https://performance.danvilleva.gov/api/assets/CCCB40EE-C156-45E6-9CAD-D0BC05347DD1", "www.metrochicagodata.org": "https://www.metrochicagodata.org/stylesheets/images/common/favicon.ico"};
                var map = new google.maps.Map(mapElement, mapOptions);
                var domains = JSON.parse($.ajax({
                    type: "GET",
                    url: "https://odn.data.socrata.com/resource/jwbj-xtgt.json?$where=location%20IS%20NOT%20NULL&$limit=1000",
                    async: false
                }).responseText);
                $.each(domains, function(i, v) {
                  var image = {
		    url: domains_to_icons[v['domain']],
		    // This marker is 20 pixels wide by 32 pixels high.
		    scaledSize: new google.maps.Size(20, 20),
		    // The origin for this image is (0, 0).
		    origin: new google.maps.Point(0, 0),
		    // The anchor for this image is the base of the flagpole at (0, 32).
		    anchor: new google.maps.Point(0, 32)
		  };
                  var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(v['location']['coordinates'][1], v['location']['coordinates'][0]),
                    map: map,
                    title: v['domain'],
                    //icon: 'https://'+v['domain']+'/stylesheets/images/domains/'+v['domain']+'/favicon.ico'
                    //icon: 'https://data.seattle.gov/stylesheets/images/domains/data.seattle.gov/favicon.ico'
                    icon: image
                  });
                  marker.addListener('click', function() {
                    dataPortalModal(this.title, this.icon.url);
                  });
                });
                window.domains = domains;
                if (navigator.geolocation) {
                  navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                      lat: position.coords.latitude,
                      lng: position.coords.longitude
                    };
              
                    
                    map.setCenter(pos);
                    
                    domain_distances = []
                    $.each(domains, function(i, v){
                      d = distance(v['location']['coordinates'][1], v['location']['coordinates'][0], position.coords.latitude, position.coords.longitude, 'M');
                      domain_distances.push({'domain': v['domain'], 'distance': d});
                      
                    });
                    domain_distances = sortByKey(domain_distances, 'distance');
                    ////console.log(JSON.stringify(sortByKey(domain_distances, 'distance')));
                    //console.log(JSON.stringify(domain_distances));
                    //console.log(JSON.stringify(sortByKey(domain_distances, 'distance')));
                    //$('body').append('<div id="nearest_data_portals" style="position:fixed;z-index:2;width:200px;height:200px;left:0;bottom:0;overflow:auto;"><strong>Nearest data portals</strong><br/></div>');
                    $.each(domain_distances, function(i, v){
                    	$('#nearest_data_portals').append('<li><a href="#" data-icon="'+domains_to_icons[v['domain']]+'" data-domain="'+v['domain']+'"><img src="'+domains_to_icons[v['domain']]+'" style="height:20px;width:20px;" /> '+v['domain']+' ('+Math.round(v['distance'])+' miles)</a></li>');
                    });
                  }, function() {
                    
                  });
                } 
            }
        </script>




  
</head>

<body>
  <script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'sodaplus/sodaplus.github.io',
    activationElement: false
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/" style="background:url('/sodaplaygroundlogo.png') 10px 5px no-repeat;padding-left:73px;">SODA Playground</a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">About SODA Playground <span class="caret"></span></a>
          <ul class="dropdown-menu scrollable-menu" role="menu">
            
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Explore open data powered by Socrata <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li>
          			<a class="trigger right-caret">Level 1</a>
          			<ul class="dropdown-menu sub-menu">
          				<li><a href="#">Level 2</a></li>
          				<li>
          					<a class="trigger right-caret">Level 2</a>
          					<ul class="dropdown-menu sub-menu">
          						<li><a href="#">Level 3</a></li>
          						<li><a href="#">Level 3</a></li>
          						<li>
          							<a class="trigger right-caret">Level 3</a>
          							<ul class="dropdown-menu sub-menu">
          								<li><a href="#">Level 4</a></li>
          								<li><a href="#">Level 4</a></li>
          								<li><a href="#">Level 4</a></li>
          							</ul>
          						</li>
          					</ul>
          				</li>
          				<li><a href="#">Level 2</a></li>
          			</ul>
          		</li>
          		<li><a href="#">Level 1</a></li>
          		<li><a href="#">Level 1</a></li>
          	</ul>
          </ul>
        </li>
      </ul>
      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
        <input type="text" id="domains" class="form-control" placeholder="Data portal" /> 
<input type="text" id="dataset" class="form-control" placeholder="Dataset" />
</div>
<!--<input type="button" id="go_to_official_frontend" value="Go to official frontend" />-->
      </form>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dataset tools <span class="caret"></span></a>
          <ul class="dropdown-menu scrollable-menu" role="menu">
            <li><a href="#" id="openQueryBuilder">Query builder (CTRL-Q)</a></li>
          </ul>
        </li>
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/sodaplaygrounddotcom/sodaplaygrounddotcom.github.io/"><i class="fa fa-github"></i></a></li>
      </ul>
    </div>
  </div>
</nav>
<button class="js-gitter-toggle-chat-button btn btn-primary" style="position:absolute;top:55px;right:10px;height:30px" data-gitter-toggle-chat-state="true">
  <span class="small">Chat about project with Github account</span></button>

<footer class="footer small">
  
  SODA Playground is an independent 
<a href="https://github.com/sodaplus/sodaplus.github.io">open source software proj;ect</a> 
to play around with ideas for making it easier to publish and use data with SODA, the 
<a href="https://dev.socrata.com/">Socrata Open Data API</a>. 

    </footer>
<div class="jumbotron">
	
  <h1>Map of open data portals powered by <a href="http://socrata.com">Socrata</a></h1>
  <div class="btn-group">
  <a href="#" class="btn btn-default">Nearest data portals</a>
  <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
  <ul id="nearest_data_portals" class="dropdown-menu scrollable-menu">
    
  </ul>
</div>
</div>
<div id="map"></div>
<!-- $select	The set of columns to be returned	All columns, equivalent to $select=*	SELECT
$where	Filters the rows to be returned	No filter	WHERE
$order	Specifies the order of results	Unspecified order	ORDER BY
$group	Column to group results on, similar to SQL Grouping	No grouping	GROUP BY
$limit	Maximum number of results to return	1000 (legacy: maximum of 50,000; new endpoints: unlimited »)	LIMIT
$offset	Offset count into the results to start at, used for paging	0	OFFSET
$q	Performs a full text search for a value.	No search -->

<div class="modal fade small" id="queryBuilderModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
        	<h4>Query Builder</h4>
        
        </div>
        <div class="modal-body">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          <div class="form-group">
    <label>Soql url</label>
    <input type="text" class="form-control" id="soqlUrl" />
  </div>
  <div class="form-group">
    <label>$q (search every field for values in their root form. For exact matching you need to use the like function in a $where)</label>
    <input type="text" class="form-control" id="soqlUrl" />
    <p>parameter is used to access a special full-text index that searches within the dataset.
    The full-text index spans all of the fields of the dataset, so think of it more like using
    a search engine than performing a SQL query.</p>
<p>Multiple search terms are ANDed together, rather than used as a phrase search,
and words are stemmed before indexing and before each query. Stemming reduces
each word down to its base or root form, so plural nouns like “criminals” will
be reduced down to the singular “criminal”, and verbs like “stealing” will
reduced down to their root of “steal”. So, searching with $q=stealing bicycles
would match on the phrase “he was looking for a bicycle to steal” as well as
the words “steals” and “bicycles” in different columns of a given record.</p>
  </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>

<div class="modal fade" id="dataPortalModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Modal Header</h4>
        </div>
        <div class="modal-body">
          <p>Some text in the modal.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>

<div id="dataset_viewer">
  <div id="right_sidebar" style="display:none">
<strong>Url:</strong> <input style="width:80%" type="text" id="url" /> <span id="number_of_rows"></span> rows
  
<ul>
<li><input type="button" value="Go to view without any parameters" id="go_to_main_view" /></li>
<li><strong>Query:</strong> <input id="q" /><input type="button" id="q_go" value="Go" /><input type="button" value="Clear" id="q_clear" /></li>
<li><strong>Simple filtering:</strong> <ul id="simple_filtering_fields">
 
</ul></li>
<li>
<strong>Select:</strong><br/>
<input type="button" value="Select all (great for quickly unselecting what you don't want)" id="select_all" />
<ul id="fields"> 

</ul></li>
<li><strong>Where:</strong></li>
<li><strong>Group:</strong>
<ul id="group_fields"> 

</ul>
</li>
<li><strong>Offset:</strong> <input type="text" id="offset" /></li>
<li><strong>Limit:</strong> <input type="text" id="limit" /></li>
<li><strong>Order:</strong></li>
</ul>
</div>
<div id="data">

</div>
</div>
<script type='text/javascript'>//<![CDATA[
function dataPortalModal(domain, icon) {
	$("#dataPortalModal h4").html('<img src="'+icon+'" style="width:20px;height:20px;" /> '+domain);
	$("#dataPortalModal p").text('abc');
	
	$("#dataPortalModal").modal();
}
function getJsonFromUrl() {
  var url = window.location.hash;
  //console.log(url);
  if (url.indexOf('?') > -1) {
    query = url.substring(url.indexOf('?')+1);
    var result = {};
    query.split("&").forEach(function(part) {
      var item = part.split("=");
      result[item[0]] = decodeURIComponent(item[1]);
    });
    return result;
  } else {
    return {}
  }
  
}
function updateQueryGUI() {
  urlJson = getJsonFromUrl();
  if (Object.keys(urlJson).indexOf('$q') > -1) {
    //console.log('is in');
    $('#q').val(urlJson['$q']);
  }
  if (Object.keys(urlJson).indexOf('$select') > -1) {
    var selects = urlJson['$select'].split(',');
    $.each(selects, function(i, v) {
      setTimeout(function(){$('input[value="'+v+'"].select').prop('checked', true);},1000);
    });
    
  }
  if (Object.keys(urlJson).indexOf('$group') > -1) {
    var selects = urlJson['$group'].split(',');
    $.each(selects, function(i, v) {
      setTimeout(function(){$('input[value="'+v+'"].group').prop('checked', true);},1000);
    });
    
  }
  //console.log(JSON.stringify(urlJson));
}
function getItemsForField(field) {
  window.urlElements = getJsonFromUrl();
  //console.log('THE URL ELEMENTS '+window.urlElements)
  $.get('https://'+domain+'/resource/'+datasetID+'.json?$select='+field+'&$group='+field+'&$limit=500', function(data) {
    var selectedHtml = '';
    if (!(Object.keys(window.urlElements).indexOf(field) > -1)) {
      selectedHtml = ' selected';
    }
    $('#simple_filtering_field__'+field).append('<option'+selectedHtml+'></option>');
    $.each(data, function(i, item) {
      if (String(item[field]) != 'undefined') {
        var selectedHtml = '';
        if (Object.keys(window.urlElements).indexOf(field) > -1) {
          if (item[field] == window.urlElements[field]) {
            selectedHtml = ' selected';
          }
        }
        $('#simple_filtering_field__'+field).append('<option'+selectedHtml+'>'+item[field]+'</option>');
      }
    });
  });
}
function getFields() {
  if (window.location.hash.indexOf('?') > -1) {
    var base_url = window.location.hash.substring(1, window.location.hash.indexOf('?'));
  } else {
    var base_url = window.location.hash.substring(1);
  }
  $.get(base_url+'?$limit=1', function(data) {
    var fields = Object.keys(data[0]).concat([':id', ':created_at', ':updated_at', 'count(*)']);
    var fields_checkboxes = '';
    if (window.location.hash.indexOf('?') > -1) {
      var base_url = window.location.hash.substring(1, window.location.hash.indexOf('?'));
    } else {
      var base_url = window.location.hash.substring(1);
      
    }
    //console.log('base url '+base_url)
    window.base_url = base_url;
    url = base_url;
    //$('#url').val(url);
    $.each(fields, function(i, v) {
      fields_checkboxes += '<li><input type="checkbox" value="'+v+'" class="select" /> '+v+'</li>';
    });
    $('#fields').html(fields_checkboxes);
    var simple_filtering_fields = '';
    $.each(fields, function(i, v) {
      simple_filtering_fields += '<li><strong>'+v+'</strong>: <select id="simple_filtering_field__'+v+'" data-field="'+v+'"></select></li>';
      getItemsForField(v);
    });
    $('#simple_filtering_fields').html(simple_filtering_fields);
    group_fields_html = ''
    $.each(fields, function(i, v) {
      group_fields_html += '<li><input type="checkbox" value="'+v+'" class="group" /> '+v+'</li>';
    });
    $('#group_fields').html(group_fields_html);
  });
}
function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
function loadTable(data) {
  //fields = Object.keys(data[0]); // sometimes fields are missing in first row
  if (window.location.hash.indexOf('9qnw-vqnm') > -1 || window.location.hash.indexOf('tpvk-5fr3') > -1) {
    var dataToJoin = {}
    dataToJoin["roster"] = JSON.parse($.ajax({
        type: "GET",
        url: "https://opendata.socrata.com/resource/aspn-jfpg.json?$limit=50000",
        async: false
    }).responseText);
    var toJoin = {"filename": {"dataset": "roster", "before": "@", "field": "serial"}, "userid": {"dataset": "roster", "field": "serial"}}
  } else {
    var dataToJoin = {};
    var toJoin = {};
  }
  var fields = [];
  var columns = JSON.parse($.ajax({
        type: "GET",
        url: "https://"+domain+"/api/views/"+dataset+"/columns.json",
        async: false
    }).responseText);
  $.each(data, function(i, row) {
    $.each(Object.keys(row), function(j, key) {
      if (fields.indexOf(key) == -1) {
        fields.push(key);
        if (Object.keys(toJoin).indexOf(key) > -1) {
          $.each(Object.keys(dataToJoin[toJoin[key]["dataset"]][0]), function(i, f) {
            if (f != toJoin[key]["field"]) {
              fields.push(key+'__'+f);
            }
          })
        }
      }
    });
  });
  table_html = '<table  class="table">';
  table_html += '<tr>';
  $.each(fields, function(i, v) {
    if (v == 'address') {
        table_html += '<th>Streetview</th>';
      }
    table_html += '<th>'+v+'</th>';
  })
  table_html += '</tr>';
  $.each(data, function(i, row) {
    table_html += '<tr>';
    $.each(fields, function(j, col) {
      if (col == 'address') {
        var ending = '';
        if (window.location.hash.indexOf('seattle') > -1) {
          ending = ' seattle, wa';
        } else if (fields.indexOf('location_city') > -1) {
          ending = ', '+row['location_city']+', '+row['location_state'];
        }
        table_html += '<td><img src="https://maps.googleapis.com/maps/api/streetview?size=100x100&location='+row['address']+ending+'" /></td>';
      }
      table_html += '<td>';
      if (window.location.hash.indexOf('?') > -1) {
        hashUrlForFiltering = window.location.hash.substring(0,window.location.hash.indexOf('?'));
      } else {
        hashUrlForFiltering = window.location.hash;
      }
      hashUrlForFiltering = hashUrlForFiltering + '?' + col + '=' + escape(row[col])
      if (col.indexOf('__') > -1) {
          //var toJoin = {"userid": {"dataset": "roster", "field": "serial"}}
          var base_field = col.substring(0, col.indexOf('__'));
          
          //console.log(base_field+' || '+col.substring(col.indexOf('__')+2))
          var theToJoin = toJoin[base_field];
          var theData = dataToJoin[theToJoin["dataset"]];
          var lookForField = theToJoin["field"];
          if (Object.keys(toJoin[base_field]).indexOf('before') > -1) {
            var lookForValue = row[base_field].substring(0,row[base_field].indexOf(toJoin[base_field]['before']));
          } else {
            //console.log('lookForValue '+row[base_field])
            var lookForValue = row[base_field];
          }
          // .substring(0,theDataRow[lookForField].indexOf(toJoin[base_field]['before']))
          
          $.each(theData, function(j, theDataRow) {
            
            
            if (theDataRow[lookForField] == lookForValue) {
              table_html += theDataRow[col.substring(col.indexOf('__')+2)];
            } 
          })
        } else if (String(row[col]).indexOf('http') > -1) {
        table_html += '<a href="'+row[col]+'" class="filter_url">'+row[col]+'</a>';
      } else if (String(row[col]) == 'undefined') {
        table_html += '';
      
      } else if (String(row[col]) == '[object Object]') {
        table_html += JSON.stringify(row[col]);
      } else if (col == 'count') {
      	table_html += numberWithCommas(row[col]);
      } else if (String(row[col]).length < 50) {
        table_html += '<a href="'+hashUrlForFiltering+'" class="filter_url">'+row[col]+'</a>';
      } else {
        // highlight search words
        if ($('#q').val()) {
          table_html += row[col].split($('#q').val()).join('<span class="highlight">'+$('#q').val()+'</span>');
        } else {
          table_html += row[col];
        }
      }
      table_html += '</td>';
      
    })
    table_html += '</tr>';
  })
  table_html += '</table>';
  $('#data').html(table_html);
  $('#data').trigger("click");
  setTimeout(function() {$('#data').doubleScroll();},2000);
  //$('#data').text(JSON.stringify(data));
}
function getData() {
  if (window.location.hash == '') {
    return
  }
  hideMapTable();
  if (window.location.hash.indexOf('.json') > -1 && window.location.hash.indexOf('$order=') == -1 && window.location.hash.indexOf('$group=') == -1) {
    var newpart = '';
    
    if (window.location.hash.indexOf('?') == -1) {
      newpart = '?';
    } else {
      newpart = '&';
    }
    newpart += '$order=:created_at%20DESC';
    window.location.hash += newpart;
    return
  }
 
  if (window.location.hash.substring(1)) {
    urlToGet = window.location.hash.substring(1);
  } else {
    urlToGet = $('#url').val();
  }
  if (urlToGet.indexOf('$limit=') == -1) {
    if (urlToGet.endsWith('json')) {
      urlToGet += '?'
    } else {
      urlToGet += '&'
    
    }
    urlToGet += '$limit=100'
  }
  //console.log('going to url '+urlToGet);
  window.domain = window.location.hash.substring(9,window.location.hash.substring(9).indexOf('/')+9);
  window.datasetID = window.location.hash.substring(window.location.hash.indexOf('/resource/')+10, window.location.hash.indexOf('.json'));
  document.title = $('#dataset').val() + ' | ' + $('#domains').val();
  if (urlToGet.indexOf('.json') > -1) {
    getFields();
    $.get('https://'+domain+'/resource/'+datasetID+'.json?$select=count(*)', function(data) {
      $('#number_of_rows').text(parseInt(data[0]['count']).toLocaleString('en-US'));
    });
    $.get(urlToGet, function(data) {
        loadTable(data);
    }).fail(function(data) {//console.log('yes');
        $('#data').text(JSON.stringify(data));
    });
  }
}

function run() {
  urlElements = {}
  var selected = [];
  var grouped = [];
  var simpleFilters = {};
    $('input[type=checkbox].select').each(function(v) {
      if ($(this).is(':checked')) {
        selected.push($(this).val());
      }
      
    });
    $('#simple_filtering_fields select').each(function(v) {
      if ($(this).find('option:selected').text()) {
        simpleFilters[$(this).attr('data-field')] = $(this).find('option:selected').text();
      }
    });
    $('input[type=checkbox].group').each(function(v) {
      if ($(this).is(':checked')) {
        grouped.push($(this).val());
      }
      
    });
    if (Object.keys(simpleFilters).length > 0) {
      $.each(Object.keys(simpleFilters), function(i, v) {
        urlElements[v] = simpleFilters[v];
      });
    }
    if (selected.length > 0) {
      urlElements['$select'] = selected.join();
    }
    if (grouped.length > 0) {
      urlElements['$group'] = grouped.join();
    }
    if ($('#q').val()) {
      urlElements['$q'] = $('#q').val();
    }
    joinedUrlElements = []
    $.each(Object.keys(urlElements), function(i, v) {
      joinedUrlElements.push(v + '=' + urlElements[v])
    });
    url = window.base_url + '?' + joinedUrlElements.join('&');
    $('#url').val(url);
    $('#url').trigger('input');
    window.urlElements = urlElements;
}
function hideMapTable() {
  if (window.location.hash != '') {
    $('#map').hide();
    $('.jumbotron').hide();
    $('#dataset_viewer').show();
  }
}
$(function() {
  $('#map_table').width($(window).width()); // css 100% isn't working
  $('#map').height($(window).height()-$('nav').outerHeight()-$('footer').outerHeight());
  $('#data').height($(window).height()-$('nav').outerHeight()-20);
  //console.log('for hiding map '+window.location.hash)
  hideMapTable();
  setTimeout(function() {$('#data').doubleScroll();},2000);
  $('#go').click(function(e) {
    getFields($('#api_id').val());
  });
  $('body').on('change', 'input[type=checkbox], select', function(e) {
    run()
  });
  $('#right_sidebar input').keyup(function(e){
    if(e.keyCode == 13)
    {
        run()
    }
  });
  $('#go').trigger('click');
  $('#url').each(function() {
  
   var elem = $(this);

   // Save current value of element
   elem.data('oldVal', elem.val());

   // Look for changes in the value
   elem.bind("propertychange change click keyup input paste", function(event){
      // If value has changed...
      if (elem.data('oldVal') != elem.val()) {
       // Updated stored value
       elem.data('oldVal', elem.val());

       // Do action
       //alert('change');
       window.location.hash = $('#url').val();
       getData()
     }
   });
 });
    
  //setTimeout(function() {$('#url').trigger('input');},1000);
  $('#q_go').click(function() {
    run();
  });
  updateQueryGUI();
  domain = window.location.hash.substring(9,window.location.hash.substring(9).indexOf('/')+9);
  $('#domains').val(domain);
  //console.log('domain parse '+domain+(window.location.hash.substring(9).indexOf('/')+9)+window.location.hash.substring(9))
  
  datasetID = window.location.hash.substring(window.location.hash.indexOf('/resource/')+10,window.location.hash.indexOf('.json'));
  window.datasetID = datasetID;
  //console.log('dataset ID '+datasetID);
  setTimeout(function() {getData();}, 1000);
  $('body').on('click', '.filter_url', function(e) {
    setTimeout(function(){getData();},500);
  })
  var domains = [];
  $.get('http://api.us.socrata.com/api/catalog/v1/domains', function(data) {
    data = data["results"];
    $.each(data, function(i, v) {
      domains.push(v['domain']);
    });
    $( "#domains" ).autocomplete({
      source: domains
    });
  });
  var datasets = [];
  
  $.get('http://funwithsoda.github.io/catalog.json', function(data) {
    //data = JSON.parse(data);
    window.datasetIDToDomain = data['datasets_to_domain'];
    
    window.allDatasets = data['datasets'];
    if (window.location.hash.indexOf('.json') > -1) {
      window.datasetID = window.location.hash.substring(window.location.hash.indexOf('/resource/')+10, window.location.hash.indexOf('.json'));
      $.each(window.allDatasets, function(i, v) {
        if (v.indexOf(window.datasetID) > -1) {
          $('#dataset').val(v);
        }
      });
    }
    $( "#dataset" ).autocomplete({
      source: window.allDatasets,
      select: function(e, ui) {  
        setTimeout(function(){$('#dataset').trigger('change');},1000);
        
      }
    });
  });
  $('body').on('input propertychange paste autocompleteselect autocompletechange change autocompleteselect', '#dataset', function(e) {
    //console.log($(this).val());
    if ($(this).val().indexOf(' | ') > -1) {
      //console.log('yes');
      var datasetID = $(this).val().substring(0, $(this).val().indexOf(' | '));
      //console.log(datasetID+'*');
      var domain = window.datasetIDToDomain[datasetID];
      //console.log(domain);
      $('#domains').val(domain);
      var newUrl = 'https://'+domain+'/resource/'+datasetID+'.json';
      $('#url').val(newUrl);
      $('#url').trigger('input');
      //setTimeout(function() {getFields(domain, datasetID);}, 500);
      
    }
  });
  $(window).on('hashchange', function() {
    
    getData();
    $('#url').val(window.location.hash.substring(1));
  });
  if (window.location.hash) {
    $('#url').val(window.location.hash.substring(1));
  }
  $('body').on('click', '#go_to_main_view', function() {
    window.location.hash = 'https://'+domain+'/resource/'+datasetID+'.json';
    
  });
  $('body').on('click', '#select_all', function() {
    $('.select').not("input[value='count(*)'].select").prop('checked', true)
  });
  $('body').on('click', '#dataset', function() {
    $('#dataset').val('');
  })
  $('body').on('click', '#go_to_official_frontend', function() {
    window.location = 'https://'+domain+'/resource/'+datasetID;
  })
  $('body').on('click', '#openQueryBuilder', function(e) {
    $('#queryBuilderModal').modal();
    e.preventDefault();
  });
  $(document).keypress("q",function(e) {
	  if(e.ctrlKey) {
	    $('#queryBuilderModal').modal('toggle');
      e.preventDefault();
	  }
	});
  $('body').on('click', '#nearest_data_portals a', function(e) {
    dataPortalModal($(this).attr('data-domain'), $(this).attr('data-icon'));
    e.preventDefault();
  });
  $(".dropdown-menu > li > a.trigger").on("click mouseenter",function(e){
    console.log("trigger");
		var current=$(this).next();
		var grandparent=$(this).parent().parent();
		if($(this).hasClass('left-caret')||$(this).hasClass('right-caret'))
			$(this).toggleClass('right-caret left-caret');
		grandparent.find('.left-caret').not(this).toggleClass('right-caret left-caret');
		grandparent.find(".sub-menu:visible").not(current).hide();
		current.toggle();
		e.stopPropagation();
	});
	$(".dropdown-menu > li > a:not(.trigger)").on("click hover",function(){
		var root=$(this).closest('.dropdown');
		root.find('.left-caret').toggleClass('right-caret left-caret');
		root.find('.sub-menu:visible').hide();
	});
	setTimeout(function() {$(".footer").hide()}, 15000);
})
//]]> 

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74176774-1', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>

